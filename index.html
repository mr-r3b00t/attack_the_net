<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacking Game</title>
    <style>
        * {
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            display: grid;
            grid-template-columns: 70% 30%;
            height: 100%;
            width: 100%;
        }
        #mynetwork {
            border-right: 1px solid #ccc;
            overflow: hidden;
        }
        #log {
            padding: 1rem;
            background: #222;
            overflow-y: auto;
            max-height: 100%;
            display: flex;
            flex-direction: column;
        }
        #log h3 {
            margin: 0 0 1rem;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        #log-content {
            flex-grow: 1;
            overflow-y: auto;
        }
        #log p {
            margin: 0.5rem 0;
            font-size: 1rem;
            line-height: 1.5;
        }
        #menu {
            position: fixed;
            background: #333;
            padding: 1rem;
            border: 1px solid #666;
            display: none;
            z-index: 1000;
        }
        #menu button {
            display: block;
            margin: 0.5rem 0;
            background: #444;
            color: #fff;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            text-align: left;
        }
        #menu button:hover {
            background: #555;
        }
        #menu button.hidden {
            display: none;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #333;
            padding: 2rem;
            border: 1px solid #666;
            border-radius: 5px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        .modal-content h2 {
            margin: 0 0 1rem;
            font-size: 2rem;
            color: #66ff66;
        }
        .modal-content p {
            margin: 0.5rem 0;
            font-size: 1.2rem;
        }
        .modal-content .button-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .modal-content button {
            background: #444;
            color: #fff;
            border: none;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 3px;
        }
        .modal-content button:hover {
            background: #555;
        }
        .modal-content .tweet-button {
            background: #1DA1F2; /* Twitter blue */
        }
        .modal-content .tweet-button:hover {
            background: #1991DB;
        }
        .modal-content .start-button {
            background: #66ff66; /* Green to match theme */
        }
        .modal-content .start-button:hover {
            background: #55cc55;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 100%;
                grid-template-rows: 60% 40%;
            }
            #mynetwork {
                border-right: none;
                border-bottom: 1px solid #ccc;
            }
            #log {
                max-height: 40vh;
            }
            .modal-content {
                padding: 1.5rem;
            }
            .modal-content h2 {
                font-size: 1.5rem;
            }
            .modal-content p {
                font-size: 1rem;
            }
            .modal-content .button-container {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
    <script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="mynetwork"></div>
        <div id="log">
            <h3>Action Log</h3>
            <div id="log-content"></div>
        </div>
    </div>
    <div id="menu">
        <button onclick="performAction('scan')" aria-label="Scan node for services">Scan</button>
        <button id="exploit-button" class="hidden" onclick="performAction('exploit')" aria-label="Exploit node to compromise it">Exploit</button>
        <button onclick="closeMenu()" aria-label="Close action menu">Close</button>
    </div>
    <div id="intro-modal" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2>Are you ready to attack the Net?</h2>
            <button class="start-button" onclick="startGame()">START</button>
        </div>
    </div>
    <div id="win-modal" class="modal">
        <div class="modal-content">
            <h2>Mission Success</h2>
            <p>Game Over</p>
            <p id="time-taken">Time Taken: --:--</p>
            <p id="score">Score: 0</p>
            <div class="button-container">
                <button onclick="restartGame()">Restart</button>
                <button class="tweet-button" id="tweet-button">Tweet Score</button>
            </div>
        </div>
    </div>
    <script>
        // Define nodes with services, vulnerabilities, and tools
        var nodes = new vis.DataSet([
            { id: 1, label: 'Internet', originalLabel: 'Internet', group: 'internet', compromised: true, contains_tools: ['Web Exploit'], exploitable: false },
            { id: 2, label: '', originalLabel: 'Web Server', group: 'dmz', services: ['HTTP'], required_tool: 'Web Exploit', contains_tools: ['Email Credential'], exploitable: true },
            { id: 3, label: '', originalLabel: 'Email Server', group: 'dmz', services: ['SMTP'], required_tool: 'Email Credential', contains_tools: ['VPN Credential'], exploitable: true },
            { id: 4, label: '', originalLabel: 'VPN Server', group: 'dmz', services: ['VPN'], required_tool: 'VPN Credential', contains_tools: ['HR Credential', 'Firewall Exploit'], exploitable: true },
            { id: 5, label: '', originalLabel: 'Firewall', group: 'firewall', services: [], required_tool: 'Firewall Exploit', contains_tools: [], exploitable: true, hidden: true },
            { id: 6, label: '', originalLabel: 'Domain Controller 1', group: 'internal', services: ['RDP'], required_tool: 'DC Credential', contains_tools: [], exploitable: true, hidden: true },
            { id: 7, label: '', originalLabel: 'Domain Controller 2', group: 'internal', services: ['RDP'], required_tool: 'DC Credential', contains_tools: [], exploitable: true, hidden: true },
            { id: 8, label: '', originalLabel: 'File Server', group: 'internal', services: [], required_tool: 'User Credential', contains_tools: [], exploitable: true, hidden: true },
            { id: 9, label: '', originalLabel: 'HR Web Server', group: 'internal', services: ['HTTP', 'RDP'], required_tool: 'HR Credential', contains_tools: ['DB Credential'], exploitable: true, hidden: true },
            { id: 10, label: '', originalLabel: 'HR Database Server', group: 'internal', services: [], required_tool: 'DB Credential', contains_tools: ['User Credential'], exploitable: true, hidden: true },
            { id: 11, label: '', originalLabel: 'ERP', group: 'internal', services: ['HTTP'], required_tool: 'DC Credential', contains_tools: [], exploitable: true, hidden: true },
            { id: 12, label: '', originalLabel: 'CRM', group: 'internal', services: ['HTTP'], required_tool: 'DC Credential', contains_tools: [], exploitable: true, hidden: true },
            { id: 13, label: '', originalLabel: 'Workstation', group: 'internal', services: ['RDP'], required_tool: 'VPN Credential', contains_tools: ['Admin Credential'], exploitable: true, hidden: true },
            { id: 14, label: '', originalLabel: 'IT Admin Machine', group: 'internal', services: ['RDP'], required_tool: 'Admin Credential', contains_tools: ['DC Credential'], exploitable: true, hidden: true },
            { id: 15, label: '', originalLabel: 'Backup Server', group: 'internal', services: [], required_tool: 'DC Credential', contains_tools: [], exploitable: true, hidden: true }
        ]);

        // Define edges
        var edges = new vis.DataSet([
            { id: '1-2', from: 1, to: 2 },
            { id: '1-3', from: 1, to: 3 },
            { id: '1-4', from: 1, to: 4 },
            { id: '2-5', from: 2, to: 5, hidden: true },
            { id: '3-5', from: 3, to: 5, hidden: true },
            { id: '4-5', from: 4, to: 5, hidden: true },
            { id: '5-6', from: 5, to: 6, hidden: true },
            { id: '5-7', from: 5, to: 7, hidden: true },
            { id: '5-8', from: 5, to: 8, hidden: true },
            { id: '5-9', from: 5, to: 9, hidden: true },
            { id: '5-11', from: 5, to: 11, hidden: true },
            { id: '5-12', from: 5, to: 12, hidden: true },
            { id: '5-13', from: 5, to: 13, hidden: true },
            { id: '5-14', from: 5, to: 14, hidden: true },
            { id: '5-15', from: 5, to: 15, hidden: true }, // Backup Server connected to Firewall
            { id: '9-10', from: 9, to: 10, hidden: true } // HR Database Server only connected to HR Web Server
        ]);

        // Initialize network
        var container = document.getElementById('mynetwork');
        var data = { nodes: nodes, edges: edges };
        var options = {
            nodes: {
                shape: 'dot',
                size: 15,
                font: { size: 12, color: '#fff' },
                borderWidth: 2
            },
            groups: {
                internet: { color: { background: '#ff6666', border: '#cc0000' } },
                dmz: { color: { background: '#66ccff', border: '#0066cc' } },
                firewall: { color: { background: '#ffcc00', border: '#cc9900' } },
                internal: { color: { background: '#66ff66', border: '#00cc00' } }
            },
            edges: {
                color: { color: '#ccc' },
                width: 1
            },
            interaction: { 
                hover: true,
                zoomView: true,
                dragView: true
            },
            physics: { 
                enabled: true,
                stabilization: { iterations: 50 },
                barnesHut: {
                    gravitationalConstant: -2000,
                    springLength: 80
                }
            },
            layout: {
                improvedLayout: true
            }
        };
        var network = new vis.Network(container, data, options);
        network.fit(); // Fit network to container on load

        // Player state
        var player = {
            position: 1, // Start at Internet (unused but retained)
            tools: ['Web Exploit'], // Initialize with Internet's tools
            compromisedNodes: [1], // Internet is compromised
            reachableNodes: [2, 3, 4], // Initially can reach Web Server, Email Server, VPN Server
            scannedNodes: [], // Track scanned nodes
            startTime: null // Set when START button is clicked
        };

        // Log function
        function addToLog(message) {
            var logContent = document.getElementById('log-content');
            var entry = document.createElement('p');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTo({ top: logContent.scrollHeight, behavior: 'smooth' });
        }

        // Format time as MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Calculate score based on time taken
        function calculateScore(timeTaken) {
            const maxScore = 100000;
            const score = Math.max(0, maxScore - timeTaken);
            return Math.floor(score);
        }

        // Start game (hide intro modal and set start time)
        function startGame() {
            var introModal = document.getElementById('intro-modal');
            introModal.style.display = 'none';
            player.startTime = Date.now();
            // Add initial log messages after starting
            addToLog('Game started. You are on the Internet. Objective: Compromise the File Server.');
            addToLog(`Initial tools: ${player.tools.join(', ') || 'None'}.`);
            addToLog(`Can initially attack: Node 2, Node 3, Node 4.`);
            addToLog('Left-click a node to open the context menu. Scan nodes to reveal their identity and services, then exploit them. Start with Node 2, Node 3, and Node 4 to reveal and attack the Firewall. Compromise the Firewall to access the internal network, then exploit HR Web Server and HR Database Server to obtain User Credential, and finally compromise File Server to win.');
        }

        // Show win modal
        function showWinModal(timeTaken, score) {
            var modal = document.getElementById('win-modal');
            var timeDisplay = document.getElementById('time-taken');
            var scoreDisplay = document.getElementById('score');
            var tweetButton = document.getElementById('tweet-button');
            timeDisplay.textContent = `Time Taken: ${formatTime(timeTaken)}`;
            scoreDisplay.textContent = `Score: ${score.toLocaleString()}`;
            const tweetText = `I attacked the net and won! my time was ${formatTime(timeTaken)} with ${score.toLocaleString()} points! play here: https://mr-r3b00t.github.io/attack_the_net/ #AttackTheNet #Hacking #game`;
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
            tweetButton.onclick = () => window.open(tweetUrl, '_blank');
            modal.style.display = 'flex';
        }

        // Restart game
        function restartGame() {
            location.reload();
        }

        // Flag to prevent immediate menu close
        let isMenuOpening = false;

        // Handle node left-click
        network.on('click', function(params) {
            if (params.nodes.length > 0) {
                var nodeId = params.nodes[0];
                if (nodeId === 1) {
                    console.log('Clicked Internet node; no menu displayed.');
                    return; // Prevent menu for Internet node
                }
                var nodeLabel = nodes.get(nodeId).originalLabel;
                console.log(`Left-clicked node ${nodeId}: ${nodeLabel}`);
                showMenu(nodeId, params.event);
            }
        });

        // Close menu on click outside
        document.addEventListener('click', function(event) {
            if (isMenuOpening) {
                isMenuOpening = false;
                return;
            }
            var menu = document.getElementById('menu');
            if (menu.style.display === 'block' && !menu.contains(event.target)) {
                console.log('Menu closed');
                closeMenu();
            }
        });

        // Show action menu in top left
        function showMenu(nodeId, event) {
            isMenuOpening = true;
            var menu = document.getElementById('menu');
            var exploitButton = document.getElementById('exploit-button');
            // Show or hide Exploit button based on scan status
            if (player.scannedNodes.includes(nodeId)) {
                exploitButton.classList.remove('hidden');
            } else {
                exploitButton.classList.add('hidden');
            }
            menu.style.left = '10px';
            menu.style.top = '10px';
            menu.style.display = 'block';
            menu.dataset.nodeId = nodeId;
            console.log(`Menu shown for node ${nodeId}: ${nodes.get(nodeId).originalLabel}`);
        }

        // Close menu
        function closeMenu() {
            var menu = document.getElementById('menu');
            if (menu.style.display === 'block') {
                console.log('Menu closed');
                menu.style.display = 'none';
            }
        }

        // Update reachable nodes after exploiting a node
        function updateReachableNodes(newNodeId) {
            var newReachable = edges.get().filter(edge => 
                edge.from === newNodeId || edge.to === newNodeId
            ).map(edge => 
                edge.from === newNodeId ? edge.to : edge.from
            ).filter(id => {
                var node = nodes.get(id);
                // Only add internal nodes if Firewall is compromised
                if (node.group === 'internal' && !player.compromisedNodes.includes(5)) {
                    return false;
                }
                // Exclude already compromised nodes and hidden nodes
                return !player.compromisedNodes.includes(id) && !node.hidden;
            });
            player.reachableNodes = [...new Set([...player.reachableNodes, ...newReachable])];
            var newNodeLabels = newReachable.map(id => nodes.get(id).originalLabel).join(', ');
            if (newNodeLabels) {
                addToLog(`Can now attack: ${newNodeLabels}.`);
            }
        }

        // Check if node is reachable
        function isReachable(nodeId) {
            return player.reachableNodes.includes(nodeId) || player.compromisedNodes.includes(nodeId);
        }

        // Check if a Domain Controller is compromised
        function hasDomainControllerCompromised() {
            return player.compromisedNodes.includes(6) || player.compromisedNodes.includes(7);
        }

        // Perform action
        function performAction(action) {
            var nodeId = parseInt(document.getElementById('menu').dataset.nodeId);
            var node = nodes.get(nodeId);
            var message = '';

            console.log(`Action performed: ${action} on node ${nodeId}: ${node.originalLabel}`);

            if (!isReachable(nodeId) && action !== 'scan') {
                message = `You cannot interact with this node. Compromise more nodes to expand your reach.`;
            } else if (node.group === 'internal' && !player.compromisedNodes.includes(5) && action !== 'scan') {
                message = `Cannot perform ${action} on this node. Compromise the Firewall to access the internal network.`;
            } else {
                switch (action) {
                    case 'scan':
                        if (!player.scannedNodes.includes(nodeId)) {
                            player.scannedNodes.push(nodeId);
                            nodes.update({ id: nodeId, label: node.originalLabel });
                            message = `Scanning ${node.originalLabel}... Found services: ${node.services.length > 0 ? node.services.join(', ') : 'None'}.`;
                        } else {
                            message = `${node.originalLabel} has already been scanned. Services: ${node.services.length > 0 ? node.services.join(', ') : 'None'}.`;
                        }
                        break;
                    case 'exploit':
                        if (!player.scannedNodes.includes(nodeId)) {
                            message = `Cannot exploit ${node.originalLabel || 'this node'}. You must scan it first.`;
                        } else if (!node.exploitable) {
                            message = `${node.originalLabel} cannot be exploited.`;
                        } else if (node.compromised) {
                            message = `${node.originalLabel} is already compromised.`;
                        } else if (node.required_tool && !player.tools.includes(node.required_tool)) {
                            message = `Cannot exploit ${node.originalLabel}. Missing required tool: ${node.required_tool}. Try exploiting other nodes to obtain it.`;
                        } else {
                            node.compromised = true;
                            player.compromisedNodes.push(nodeId);
                            nodes.update({ id: nodeId, color: { background: '#ff0000', border: '#cc0000' } });
                            if (node.contains_tools.length > 0) {
                                player.tools = player.tools.concat(node.contains_tools);
                                message = `Exploited ${node.originalLabel}! Gained: ${node.contains_tools.join(', ')}.`;
                            } else {
                                message = `Exploited ${node.originalLabel}! Node compromised.`;
                            }
                            if (nodeId === 4) {
                                // Reveal Firewall and its edges when VPN Server is compromised
                                nodes.update({ id: 5, hidden: false });
                                edges.update([
                                    { id: '2-5', hidden: false },
                                    { id: '3-5', hidden: false },
                                    { id: '4-5', hidden: false }
                                ]);
                                player.reachableNodes.push(5);
                                addToLog('Firewall discovered! It can now be attacked after scanning.');
                            } else if (nodeId === 5) {
                                // Reveal internal nodes and their edges when Firewall is compromised
                                nodes.update([
                                    { id: 6, hidden: false },
                                    { id: 7, hidden: false },
                                    { id: 8, hidden: false },
                                    { id: 9, hidden: false },
                                    { id: 10, hidden: false },
                                    { id: 11, hidden: false },
                                    { id: 12, hidden: false },
                                    { id: 13, hidden: false },
                                    { id: 14, hidden: false },
                                    { id: 15, hidden: false }
                                ]);
                                edges.update([
                                    { id: '5-6', hidden: false },
                                    { id: '5-7', hidden: false },
                                    { id: '5-8', hidden: false },
                                    { id: '5-9', hidden: false },
                                    { id: '5-11', hidden: false },
                                    { id: '5-12', hidden: false },
                                    { id: '5-13', hidden: false },
                                    { id: '5-14', hidden: false },
                                    { id: '5-15', hidden: false },
                                    { id: '9-10', hidden: false }
                                ]);
                                addToLog('Firewall compromised! Internal network discovered and accessible after scanning.');
                            } else if (nodeId === 6 || nodeId === 7) {
                                addToLog('Domain Controller compromised!');
                            } else if (nodeId === 8) {
                                const timeTaken = (Date.now() - player.startTime) / 1000; // Time in seconds
                                const score = calculateScore(timeTaken);
                                message = 'File Server compromised! Mission accomplished.';
                                showWinModal(timeTaken, score);
                            }
                            updateReachableNodes(nodeId);
                        }
                        break;
                }
            }

            addToLog(message);
            closeMenu();
        }
    </script>
</body>
</html>
